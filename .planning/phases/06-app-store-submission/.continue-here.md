---
phase: 06-app-store-submission
task: 3
total_tasks: 8
status: in_progress
last_updated: 2026-01-24T23:15:00Z
---

<current_state>
Building preview APK to test Android crash fixes. Build ID: 53167886-2173-42b1-9823-05ac90442c3b
The app was crashing on Android due to missing Google Maps API key in react-native-maps.
Fixed by adding a fallback placeholder - map shows "Map requires setup" instead of crashing.
</current_state>

<completed_work>
- Task 1: Developer Account Setup - DONE
  - Google Play Console: Account "Vibe2Future" created, identity verification pending
  - Apple Developer: $99 enrollment submitted, awaiting approval (1-2 business days)

- Task 2: App Configuration - DONE
  - app.json: Bundle IDs (com.windowseat.app), permissions, iOS/Android config
  - eas.json: development/preview/production build profiles
  - package.json: Added build scripts (build:ios, build:android, build:all, submit:ios, submit:android)
  - EAS project linked: @stonku/window-seat

- Task 3: Bug Fixes - MOSTLY DONE (testing in progress)
  - Fixed: Missing @react-native-community/netinfo dependency
  - Fixed: Development builds crash without Metro - user now uses preview builds
  - Fixed: Google Maps API key missing - added fallback placeholder on Android
  - Fixed: FlightSearch dropdown z-index - converted to full-screen modal
  - Added: ErrorBoundary component for graceful crash handling
  - Added: Detailed [Download] step logging for debugging
</completed_work>

<remaining_work>
- Task 3: Verify preview build works without crashes (build in progress)
- Task 4: Add Google Maps API key (optional, for native maps)
  - Get key from Google Cloud Console
  - Add to app.json: android.config.googleMaps.apiKey
- Task 5: Wait for Apple Developer enrollment approval
- Task 6: Build for iOS (eas build --platform ios --profile preview)
- Task 7: Create store listings
  - App descriptions (short + full)
  - Screenshots for both platforms
  - Privacy policy URL
- Task 8: Production builds and submission
  - eas build --platform all --profile production
  - eas submit --platform android
  - eas submit --platform ios
</remaining_work>

<decisions_made>
- Use preview builds for testing (not development builds) - dev builds require Metro server
- Disable native map on Android instead of requiring Google Maps API key upfront
- Convert FlightSearch from inline dropdown to full-screen modal (z-index issues in ScrollView)
- Add ErrorBoundary to catch JavaScript crashes gracefully
</decisions_made>

<blockers>
- Apple Developer enrollment: Waiting 1-2 business days for approval
- Google Play identity verification: Pending (can still create apps)
- Google Maps on Android: Shows placeholder until API key added (not blocking)
</blockers>

<context>
We're shipping Window Seat to both app stores simultaneously. The main challenge was
debugging Android crashes - initially the dev build crashed because it needs Metro,
then the preview build crashed because react-native-maps needs a Google Maps API key.

The app works fully on web (tested with EK002 flight - London to Dubai).
All features work: download, narration, checkpoints, audio, window seat advisor.

Current approach: Get Android working first with map placeholder, then add iOS once
Apple approves the developer enrollment. Google Maps API key can be added later
as an enhancement.
</context>

<next_action>
1. Check if build 53167886-2173-42b1-9823-05ac90442c3b finished:
   ```
   eas build:list --platform android --limit 1
   ```
2. Install the APK and test:
   - Enter flight number (BA115, EK002, etc.)
   - Click Download
   - Verify no crash, map shows placeholder, checkpoints load
3. If working, proceed to production build for Play Store submission
</next_action>

<build_urls>
- Latest preview build: https://expo.dev/accounts/stonku/projects/window-seat/builds/53167886-2173-42b1-9823-05ac90442c3b
- EAS dashboard: https://expo.dev/accounts/stonku/projects/window-seat
- Google Play Console: https://play.google.com/console (app: Window Seat)
</build_urls>

<files_modified_this_session>
- App.js - FlightSearch modal, ErrorBoundary, detailed logging
- app.json - Bundle IDs, permissions, EAS project ID
- eas.json - NEW: Build profiles
- package.json - Build scripts, netinfo dependency
- components/ErrorBoundary.js - NEW: Crash boundary
- components/index.js - Export ErrorBoundary
- components/RoutePreview.js - Android modal compatibility
- components/map/FlightMap.js - Google Maps fallback, error handling
- services/MapTileService.js - Route validation, timeout handling
- services/NarrationService.js - Defensive map download
- CLAUDE.md - Session notes updated
</files_modified_this_session>
